<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>üèí Hokej Mana≈æer Pro</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--bg1:#0F172A;--bg2:#1E293B;--bg3:#334155;--txt:#FFF;--txt2:#94A3B8;--txt3:#64748B;--blue:#3B82F6;--green:#10B981;--red:#EF4444;--yellow:#F59E0B;--purple:#8B5CF6;--cyan:#06B6D4}
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg1);color:var(--txt);min-height:100vh;overflow-x:hidden}
.app{display:flex;flex-direction:column;min-height:100vh}
.hdr{background:var(--bg2);padding:10px 12px;border-bottom:1px solid var(--bg3);position:sticky;top:0;z-index:100}
.hdr-c{display:flex;align-items:center;justify-content:space-between;gap:8px}
.tm-i{display:flex;align-items:center;gap:8px}
.tm-l{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:12px}
.tm-n{font-weight:700;font-size:14px}
.tm-s{font-size:10px;color:var(--txt3)}
.hdr-st{display:flex;gap:8px;align-items:center}
.st-i{text-align:right}
.st-l{font-size:8px;color:var(--txt3);text-transform:uppercase}
.st-v{font-size:12px;font-weight:700}
.grn{color:var(--green)}.red{color:var(--red)}.blu{color:var(--blue)}.ylw{color:var(--yellow)}.pur{color:var(--purple)}
.play-btn{background:linear-gradient(135deg,var(--green),#059669);border:none;color:#fff;padding:8px 12px;border-radius:8px;font-weight:700;font-size:12px;cursor:pointer}
.play-btn:disabled{background:var(--bg3);cursor:not-allowed}
.cnt{flex:1;overflow-y:auto;padding-bottom:70px}
.nav{position:fixed;bottom:0;left:0;right:0;background:var(--bg2);border-top:1px solid var(--bg3);display:flex;justify-content:space-around;padding:6px 2px;z-index:100}
.nav-b{background:none;border:none;color:var(--txt3);font-size:8px;padding:4px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;min-width:44px}
.nav-b.act{color:var(--blue)}
.nav-b .ic{font-size:16px}
.sel{padding:16px;text-align:center}
.logo-c{width:70px;height:70px;margin:16px auto;background:linear-gradient(135deg,#DC2626,#2563EB);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:32px}
.title{font-size:24px;font-weight:900;background:linear-gradient(90deg,#fff,#93C5FD,#FCA5A5);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.sub{color:var(--txt3);font-size:11px;letter-spacing:2px;margin-top:4px}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.tmc{background:rgba(30,41,59,0.6);border:1px solid rgba(71,85,105,0.3);border-radius:12px;padding:12px;cursor:pointer;text-align:center}
.tmc:active{transform:scale(0.97);border-color:var(--blue)}
.tmc .tm-l{width:44px;height:44px;margin:0 auto 8px;font-size:14px}
.tmc .nm{font-size:12px;font-weight:600}
.tmc .ct{font-size:10px;color:var(--txt3)}
.tmc .bg{font-size:11px;color:var(--green);margin-top:4px;font-weight:600}
.match-preview{background:linear-gradient(135deg,var(--bg2),var(--bg3));border-radius:12px;margin:10px;padding:14px;border:1px solid var(--blue)}
.mp-header{text-align:center;margin-bottom:12px}
.mp-title{font-size:11px;color:var(--blue);font-weight:600;text-transform:uppercase;letter-spacing:1px}
.mp-week{font-size:10px;color:var(--txt3)}
.mp-teams{display:flex;align-items:center;justify-content:space-around;margin-bottom:12px}
.mp-team{text-align:center}
.mp-team .tm-l{width:50px;height:50px;margin:0 auto 6px;font-size:16px}
.mp-team-name{font-size:12px;font-weight:600}
.mp-team-str{font-size:10px;color:var(--txt3)}
.mp-vs{font-size:18px;font-weight:900;color:var(--txt3)}
.mp-form{display:flex;gap:3px;justify-content:center}
.mp-form-dot{width:16px;height:16px;border-radius:4px;font-size:9px;display:flex;align-items:center;justify-content:center;font-weight:700}
.mp-form-dot.w{background:var(--green);color:#fff}
.mp-form-dot.l{background:var(--red);color:#fff}
.mp-form-dot.o{background:var(--yellow);color:#fff}
.pos-filter{display:flex;gap:6px;padding:8px 10px;background:var(--bg2);border-bottom:1px solid var(--bg3);overflow-x:auto}
.pos-filter::-webkit-scrollbar{display:none}
.pos-filter-btn{padding:6px 12px;border:1px solid var(--bg3);border-radius:16px;background:transparent;color:var(--txt2);font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap}
.pos-filter-btn.act{background:var(--blue);border-color:var(--blue);color:#fff}
.pl{padding:10px}
.pc{background:var(--bg2);border-radius:10px;margin-bottom:6px;border:1px solid var(--bg3);overflow:hidden}
.pc.exp{border-color:var(--blue)}
.pc.loan{border-color:var(--purple);background:rgba(139,92,246,0.05)}
.pm{display:flex;align-items:center;padding:10px;gap:10px;cursor:pointer}
.pos{width:32px;height:32px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700}
.pos.G{background:rgba(168,85,247,0.2);color:#C084FC}
.pos.D{background:rgba(59,130,246,0.2);color:#60A5FA}
.pos.F{background:rgba(239,68,68,0.2);color:#F87171}
.pi{flex:1;min-width:0}
.pn{font-weight:600;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pd{font-size:10px;color:var(--txt3);margin-top:1px}
.ovr{font-size:18px;font-weight:700}
.r85{color:#10B981}.r75{color:#22C55E}.r65{color:#EAB308}.r55{color:#F97316}.rlo{color:#EF4444}
.pex{padding:10px;border-top:1px solid var(--bg3);background:var(--bg1)}
.srow{display:flex;justify-content:space-around;margin-bottom:10px}
.sbox{text-align:center}
.sbox-l{font-size:8px;color:var(--txt3)}
.sbox-v{font-size:14px;font-weight:700}
.pex-btns{display:flex;gap:6px;flex-wrap:wrap}
.pex-btn{flex:1;min-width:60px;padding:8px 4px;border:none;border-radius:6px;font-size:9px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:3px}
.pex-btn.train{background:rgba(6,182,212,0.15);color:var(--cyan)}
.pex-btn.contract{background:rgba(245,158,11,0.15);color:var(--yellow)}
.pex-btn.loan{background:rgba(139,92,246,0.15);color:var(--purple)}
.pex-btn.release{background:rgba(239,68,68,0.1);color:var(--red)}
.pex-btn.buy{background:rgba(16,185,129,0.15);color:var(--green)}
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px}
.mdc{background:var(--bg2);border-radius:20px;padding:20px;width:100%;max-width:360px;text-align:center;border:1px solid var(--bg3);max-height:90vh;overflow-y:auto}
.md-t{font-size:18px;font-weight:700;margin-bottom:4px}
.md-s{color:var(--txt3);font-size:12px;margin-bottom:16px}
.md-b{width:100%;padding:14px;margin-bottom:8px;border:2px solid var(--bg3);border-radius:12px;background:var(--bg1);cursor:pointer;text-align:left}
.md-b:active{transform:scale(0.98);border-color:var(--blue)}
.md-bh{display:flex;align-items:center;gap:10px}
.md-bi{font-size:24px}
.md-bt{font-size:14px;font-weight:700;color:#fff}
.md-bd{font-size:10px;color:var(--txt3);margin-left:34px;margin-top:2px}
.md-btn{width:100%;padding:12px;border:none;border-radius:12px;font-weight:700;font-size:14px;cursor:pointer;margin-top:6px}
.md-btn.pri{background:var(--blue);color:#fff}
.md-btn.sec{background:var(--bg3);color:#fff}
.md-btn.grn{background:var(--green);color:#fff}
.md-btn.red{background:var(--red);color:#fff}
.md-btn.pur{background:var(--purple);color:#fff}
.md-btn:disabled{background:var(--bg3);color:var(--txt3);cursor:not-allowed}
.spd-s{margin:12px 0;padding:12px;background:var(--bg1);border-radius:10px}
.spd-t{font-size:11px;color:var(--txt3);margin-bottom:8px;text-transform:uppercase;letter-spacing:1px}
.spd-o{display:flex;gap:6px}
.spd-b{flex:1;padding:8px;border:2px solid var(--bg3);border-radius:8px;background:transparent;color:var(--txt2);font-size:11px;font-weight:600;cursor:pointer}
.spd-b.act{border-color:var(--blue);background:rgba(59,130,246,0.1);color:var(--blue)}
.tac-section{background:var(--bg2);border-radius:12px;margin:10px;padding:14px;border:1px solid var(--bg3)}
.tac-title{font-size:13px;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.tac-row{display:flex;gap:6px;margin-bottom:10px}
.tac-opt{flex:1;padding:10px 6px;border:2px solid var(--bg3);border-radius:8px;background:transparent;cursor:pointer;text-align:center}
.tac-opt.act{border-color:var(--blue);background:rgba(59,130,246,0.1)}
.tac-opt-icon{font-size:18px;margin-bottom:2px}
.tac-opt-name{font-size:9px;font-weight:600;color:var(--txt)}
.tac-slider{margin:10px 0}
.tac-slider-label{display:flex;justify-content:space-between;font-size:10px;color:var(--txt3);margin-bottom:4px}
.tac-slider input{width:100%;height:6px;border-radius:3px;-webkit-appearance:none;background:var(--bg3)}
.tac-slider input::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--blue);cursor:pointer}
.tac-effect{background:var(--bg1);padding:10px;border-radius:8px;margin-top:10px}
.tac-effect-row{display:flex;justify-content:space-between;font-size:11px;margin-bottom:4px}
.live{min-height:100vh;background:linear-gradient(180deg,#0F172A,#1E293B);display:flex;flex-direction:column}
.lhdr{padding:12px;text-align:center;border-bottom:1px solid var(--bg3)}
.lper{display:inline-flex;align-items:center;gap:6px;font-size:10px;color:var(--yellow);font-weight:700;text-transform:uppercase;letter-spacing:2px;background:rgba(245,158,11,0.1);padding:4px 10px;border-radius:16px;margin-bottom:6px}
.lper .dot{width:6px;height:6px;background:var(--yellow);border-radius:50%;animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
.ltim{font-size:44px;font-weight:900}
.lscc{display:flex;align-items:center;justify-content:center;padding:16px;gap:12px}
.ltm{text-align:center;flex:1}
.ltm .tm-l{width:48px;height:48px;margin:0 auto 6px;font-size:16px}
.ltmn{font-size:12px;font-weight:600}
.lsc{text-align:center;min-width:100px}
.lscn{font-size:44px;font-weight:900;display:flex;align-items:center;justify-content:center;gap:6px}
.lscn .div{color:var(--txt3);font-size:32px}
.pstb{display:flex;justify-content:space-around;padding:10px;background:var(--bg2);border-bottom:1px solid var(--bg3)}
.pst{text-align:center}
.pst-v{font-size:16px;font-weight:700}
.pst-l{font-size:8px;color:var(--txt3);text-transform:uppercase}
.comc{flex:1;overflow-y:auto;padding:10px 12px}
.comi{display:flex;gap:8px;margin-bottom:10px;animation:slin .3s ease-out}
@keyframes slin{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
.comt{font-size:10px;font-weight:700;color:var(--yellow);min-width:32px}
.comtx{font-size:12px;color:var(--txt2);line-height:1.3}
.comi.goal{background:linear-gradient(90deg,rgba(16,185,129,0.15),transparent);padding:10px;margin:-10px -12px 10px -12px;padding-left:12px;border-left:3px solid var(--green)}
.comi.goal .comtx{font-weight:700;color:var(--green);font-size:13px}
.comi.goal-against{background:linear-gradient(90deg,rgba(239,68,68,0.15),transparent);padding:10px;margin:-10px -12px 10px -12px;padding-left:12px;border-left:3px solid var(--red)}
.comi.goal-against .comtx{color:var(--red)}
.comi.ppgoal{background:linear-gradient(90deg,rgba(139,92,246,0.15),transparent);padding:10px;margin:-10px -12px 10px -12px;padding-left:12px;border-left:3px solid var(--purple)}
.comi.ppgoal .comtx{font-weight:700;color:var(--purple)}
.comi.period-break{background:var(--bg2);padding:12px;margin:6px -12px;text-align:center}
.comi.period-break .comtx{color:#fff;font-weight:700}
.lctl{padding:10px 12px;border-top:1px solid var(--bg3);background:var(--bg2)}
.lctl-r{display:flex;gap:8px}
.ctl-b{flex:1;padding:12px;border:none;border-radius:10px;font-weight:600;font-size:13px;cursor:pointer}
.ctl-b.suc{background:var(--green);color:#fff}
.ctl-b.sec{background:var(--bg3);color:#fff}
.spd-c{display:flex;align-items:center;justify-content:center;gap:6px;margin-top:8px}
.spd-lb{font-size:10px;color:var(--txt3)}
.spd-i{display:flex;gap:4px}
.spd-d{width:8px;height:8px;border-radius:50%;background:var(--bg3);cursor:pointer}
.spd-d.act{background:var(--blue)}
.brk{padding:20px;text-align:center}
.brk-t{font-size:20px;font-weight:900;margin-bottom:6px}
.brk-s{color:var(--txt3);font-size:12px;margin-bottom:20px}
.res-i{width:70px;height:70px;border-radius:35px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;font-size:36px}
.res-i.win{background:rgba(16,185,129,0.2)}
.res-i.loss{background:rgba(239,68,68,0.2)}
.res-t{font-size:20px;font-weight:700;margin-bottom:12px}
.res-sc{font-size:40px;font-weight:900;margin-bottom:12px}
.res-d{display:flex;justify-content:center;gap:20px;margin-bottom:16px}
.res-di{text-align:center}
.res-dv{font-size:18px;font-weight:700}
.res-dl{font-size:9px;color:var(--txt3);text-transform:uppercase}
.tbl{width:100%;border-collapse:collapse;font-size:10px}
.tbl th{font-size:8px;font-weight:600;color:var(--txt3);text-transform:uppercase;padding:8px 3px;text-align:center;background:var(--bg2)}
.tbl th:nth-child(2){text-align:left}
.tbl td{padding:8px 3px;text-align:center;border-bottom:1px solid var(--bg3)}
.tbl tr.usr{background:rgba(59,130,246,0.15)}
.tbl tr.clickable{cursor:pointer}
.tbl tr.clickable:active{background:rgba(59,130,246,0.1)}
.tc{display:flex;align-items:center;gap:4px}
.ml{width:18px;height:18px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:6px;font-weight:700;flex-shrink:0}
.pg{color:var(--green)}.pb{color:var(--blue)}.pr{color:var(--red)}
.fin-card{background:var(--bg2);border-radius:12px;padding:14px;margin:10px;border:1px solid var(--bg3)}
.fin-title{font-size:14px;font-weight:700;margin-bottom:12px}
.fin-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--bg3)}
.fin-row:last-child{border-bottom:none}
.fin-label{font-size:12px;color:var(--txt2)}
.fin-value{font-size:12px;font-weight:600}
.fin-total{background:var(--bg1);padding:10px;border-radius:8px;margin-top:10px;display:flex;justify-content:space-between}
.train-stat{display:flex;align-items:center;justify-content:space-between;padding:10px;background:var(--bg1);border-radius:8px;margin-bottom:8px}
.train-stat-name{font-size:12px;font-weight:600}
.train-stat-val{display:flex;align-items:center;gap:8px}
.train-stat-cur{font-size:16px;font-weight:700}
.train-stat-btn{width:32px;height:32px;border:none;border-radius:6px;background:var(--cyan);color:#fff;font-size:14px;font-weight:700;cursor:pointer}
.train-stat-btn:disabled{background:var(--bg3);cursor:not-allowed}
.cont-info{background:var(--bg1);padding:12px;border-radius:8px;margin-bottom:12px}
.cont-row{display:flex;justify-content:space-between;margin-bottom:6px}
.cont-row:last-child{margin-bottom:0}
.cont-label{font-size:11px;color:var(--txt3)}
.cont-value{font-size:11px;font-weight:600}
.tabs-cont{display:flex;border-bottom:1px solid var(--bg3);background:var(--bg2)}
.tab-btn{flex:1;padding:10px;border:none;background:none;color:var(--txt3);font-size:11px;font-weight:600;cursor:pointer;border-bottom:2px solid transparent}
.tab-btn.act{color:var(--blue);border-bottom-color:var(--blue)}
/* Team Detail View */
.team-header{background:var(--bg2);padding:16px;border-bottom:1px solid var(--bg3)}
.team-header-top{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.team-back{background:none;border:none;color:var(--txt2);font-size:20px;cursor:pointer;padding:4px}
.team-header .tm-l{width:56px;height:56px;font-size:18px}
.team-header-info{flex:1}
.team-header-name{font-size:18px;font-weight:700}
.team-header-city{font-size:12px;color:var(--txt3)}
.team-stats{display:flex;gap:12px;justify-content:space-around}
.team-stat{text-align:center}
.team-stat-val{font-size:18px;font-weight:700}
.team-stat-label{font-size:9px;color:var(--txt3);text-transform:uppercase}
.team-roster-title{padding:12px;font-size:14px;font-weight:600;border-bottom:1px solid var(--bg3);display:flex;justify-content:space-between;align-items:center}
.offer-info{background:var(--bg1);padding:12px;border-radius:8px;margin-bottom:12px}
.offer-row{display:flex;justify-content:space-between;margin-bottom:8px}
.offer-row:last-child{margin-bottom:0}
.offer-label{font-size:11px;color:var(--txt3)}
.offer-value{font-size:13px;font-weight:700}
</style>
</head>
<body>
<div class="app" id="app"></div>
<script>
const T=[{id:'sparta',n:'HC Sparta Praha',c:'Praha',cl:'#C8102E',b:85e6,str:82},{id:'trinec',n:'HC Ocel√°≈ôi T≈ôinec',c:'T≈ôinec',cl:'#E31837',b:90e6,str:85},{id:'pardubice',n:'HC Dynamo Pardubice',c:'Pardubice',cl:'#FF0000',b:70e6,str:78},{id:'liberec',n:'B√≠l√≠ Tyg≈ôi Liberec',c:'Liberec',cl:'#1E3A8A',b:65e6,str:75},{id:'brno',n:'HC Kometa Brno',c:'Brno',cl:'#003087',b:75e6,str:77},{id:'boleslav',n:'BK Mlad√° Boleslav',c:'M. Boleslav',cl:'#00A651',b:55e6,str:72},{id:'plzen',n:'HC ≈†koda Plze≈à',c:'Plze≈à',cl:'#0033A0',b:60e6,str:74},{id:'mountfield',n:'Mountfield HK',c:'Hr. Kr√°lov√©',cl:'#E4002B',b:58e6,str:73},{id:'litvinov',n:'HC Verva Litv√≠nov',c:'Litv√≠nov',cl:'#FFD100',b:50e6,str:70},{id:'olomouc',n:'HC Olomouc',c:'Olomouc',cl:'#003DA5',b:45e6,str:68},{id:'vitkovice',n:'HC V√≠tkovice Ridera',c:'Ostrava',cl:'#003087',b:52e6,str:69},{id:'kladno',n:'Ryt√≠≈ôi Kladno',c:'Kladno',cl:'#1E3A8A',b:40e6,str:65},{id:'motor',n:'Motor ƒå. Budƒõjovice',c:'ƒå. Budƒõjovice',cl:'#000080',b:48e6,str:67},{id:'vary',n:'HC Energie K. Vary',c:'K. Vary',cl:'#FFD700',b:42e6,str:66}];
const FN=['Jakub','David','Martin','Tom√°≈°','Luk√°≈°','Jan','Petr','Filip','Ond≈ôej','Adam','Michal','Daniel','Marek','Pavel','Ji≈ô√≠','Dominik','Roman','Radim'];
const LN=['Vor√°ƒçek','Pastr≈à√°k','Krejƒç√≠','Hertl','Neƒças','Hronek','Chytil','Zacha','Vr√°na','K√§mpf','≈†imek','Gudas','Kov√°≈ô','Plekanec','ƒåervenka','Frol√≠k','Pal√°t','Kubal√≠k'];
const C={start:['Puk je ve h≈ôe!'],end:['Konec!'],pstart:['{p}. t≈ôetina'],pend:['Konec {p}. t≈ôetiny'],ot:['Prodlou≈æen√≠!'],goal:['üö® G√ì√ìL {pl}! {s}'],goalA:['G√≥l soupe≈ôe {s}'],ppgoal:['‚ö° PP G√ìL {pl}! {s}'],shot:['{pl} st≈ô√≠l√≠!'],chance:['üò± ≈†ance {pl}!'],save:['Z√°krok {gl}!'],hit:['Hit {pl}!'],penalty:['üü° 2 min {pl}!'],ppstart:['‚ö° P≈ôesilovka!'],ppend:['Konec PP'],icing:['‚ùÑÔ∏è Icing'],offside:['üö´ Ofsajd'],poss:['{tm} √∫toƒç√≠'],crowd:['üëè']};

let gs={started:false,team:null,roster:[],budget:50e6,happiness:70,week:1,standings:[],schedule:[],market:[],otherTeams:{},tactic:{style:'balanced',pressing:50,aggression:50},h2h:{}};
let tab='roster',subTab='market',posFilter='all',expP=null,showMode=false,showLive=false,showBreak=false,showRes=false,showTrain=null,showContract=null,showLoan=null,showBuy=null,viewTeam=null,speed='normal',ls=null,mInt=null,lastRes=null;

const pk=a=>a[Math.floor(Math.random()*a.length)];
const fmt=a=>a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${Math.floor(a/1e3)}K`:a;
const rc=r=>r>=85?'r85':r>=75?'r75':r>=65?'r65':r>=55?'r55':'rlo';
const pc=p=>p==='G'?'G':p==='D'?'D':'F';
const spd=()=>({slow:1200,normal:700,fast:300})[speed];

function gP(pos,q='normal'){const b=q==='star'?80:q==='prospect'?55:65,v=15,o=Math.min(99,Math.max(40,Math.floor(b+(Math.random()-0.5)*v)));return{id:Math.random().toString(36).substr(2,9),f:pk(FN),l:pk(LN),pos,age:pos==='G'?Math.floor(Math.random()*15)+22:Math.floor(Math.random()*18)+18,o,pot:Math.min(99,Math.floor(b+10+Math.random()*15)),sk:Math.floor(b+(Math.random()-0.5)*v),sh:Math.floor(b+(Math.random()-0.5)*v),pa:Math.floor(b+(Math.random()-0.5)*v),de:Math.floor(b+(Math.random()-0.5)*v),ph:Math.floor(b+(Math.random()-0.5)*v),sal:Math.floor(o*50000+Math.random()*2e6),en:100,g:0,a:0,pm:0,gp:0,cYears:Math.floor(Math.random()*3)+1,cSigned:0,moral:70+Math.floor(Math.random()*20),onLoan:false};}
function gR(strength=70){const r=[];const q=strength>75?'star':strength>65?'normal':'prospect';r.push(gP('G',q));r.push(gP('G','prospect'));for(let i=0;i<6;i++)r.push(gP('D',i<2?q:'normal'));for(let i=0;i<12;i++)r.push(gP(['LW','C','RW'][i%3],i<3?q:i<6?'normal':'prospect'));return r;}
const iSt=()=>T.map(t=>({...t,pl:0,w:0,l:0,otW:0,otL:0,gf:0,ga:0,pts:0,form:[]}));
function gSch(){return Array.from({length:52},(_,i)=>{const op=T.filter(t=>t.id!==gs.team?.id)[i%13];return{wk:i+1,op:op.n,opId:op.id,opC:op.cl,opStr:op.str,home:i%2===0,done:false};});}
const gM=()=>Array.from({length:8},()=>{const p=gP(pk(['G','D','LW','C','RW']),Math.random()>0.6?'star':'normal');p.pr=Math.floor(p.sal*(3+Math.random()*2));p.loanFee=Math.floor(p.sal*0.3);return p;});
function initOtherTeams(){const ot={};T.filter(t=>t.id!==gs.team?.id).forEach(t=>{ot[t.id]={roster:gR(t.str),willSell:Math.random()>0.3,willLoan:Math.random()>0.4};});return ot;}
function calcPlayerPrice(p,fromTeam){const base=p.o*100000;const ageMod=p.age<25?1.3:p.age>30?0.7:1;const salMod=1+p.sal/5e6;return Math.floor(base*ageMod*salMod*(1.5+Math.random()*0.5));}
function calcLoanFee(p){return Math.floor(p.sal*0.25*(1+Math.random()*0.3));}

function getTacMods(){const t=gs.tactic;const sm={offensive:{s:1.3,d:0.7},balanced:{s:1,d:1},defensive:{s:0.7,d:1.3},counter:{s:0.9,d:1.1}}[t.style];return{shot:sm.s*(1+(t.pressing-50)/200),def:sm.d/(1+(t.aggression-50)/200)};}
const cInc=()=>Math.floor(150000*(1+gs.happiness/200));
const save=()=>localStorage.setItem('hm7',JSON.stringify(gs));
const load=()=>{const s=localStorage.getItem('hm7');if(s){gs={...gs,...JSON.parse(s)};return true;}return false;};

function getTeamStr(){const a=gs.roster.filter(p=>!p.onLoan);return a.length?Math.round(a.reduce((s,p)=>s+p.o,0)/a.length):0;}
function getNextMatch(){return gs.week<=52?gs.schedule[gs.week-1]:null;}
function getOppInfo(opId){const o=T.find(t=>t.id===opId),st=gs.standings.find(s=>s.id===opId);return{team:o,standing:st,form:st?.form||[]};}

function stG(tm){gs.team=tm;gs.budget=tm.b;gs.roster=gR(tm.str);gs.standings=iSt();gs.schedule=gSch();gs.market=gM();gs.otherTeams=initOtherTeams();gs.h2h={};gs.tactic={style:'balanced',pressing:50,aggression:50};gs.started=true;save();render();}

function shMode(){showMode=true;render();}
function stMatch(wC){showMode=false;wC?stLive():qSim();}
function stLive(){const m=gs.schedule[gs.week-1],gl=gs.roster.find(p=>p.pos==='G'&&!p.onLoan);ls={p:1,t:0,tG:0,oG:0,cm:[],dn:false,m,ps:false,gn:gl?`${gl.f.charAt(0)}.${gl.l}`:'GK',st:{tm:{sh:0,sv:0,ht:0},op:{sh:0,sv:0,ht:0}},pSt:[],pp:null,ev:gEv()};showLive=true;addC('start',pk(C.start));render();mInt=setInterval(upLive,spd());}
function gEv(){const ev=[],a=gs.roster.filter(p=>!p.onLoan),tS=a.reduce((s,p)=>s+p.o,0)/a.length,m=gs.schedule[gs.week-1],oS=m.opStr||70,hb=m.home?5:0,tac=getTacMods();for(let p=1;p<=3;p++){for(let i=0;i<12+Math.floor(Math.random()*8);i++){const t=Math.floor(Math.random()*1200),r=Math.random(),gc=0.07*tac.shot/tac.def;if(r<gc)ev.push({p,t,ty:Math.random()<(tS+hb)/(tS+hb+oS)?'goal':'goalA'});else if(r<0.18)ev.push({p,t,ty:'shot'});else if(r<0.26)ev.push({p,t,ty:'chance'});else if(r<0.34)ev.push({p,t,ty:'save'});else if(r<0.44)ev.push({p,t,ty:'hit'});else if(r<0.50)ev.push({p,t,ty:'penalty'});else if(r<0.60)ev.push({p,t,ty:'poss'});else ev.push({p,t,ty:'crowd'});}}return ev.sort((a,b)=>(a.p*1200+a.t)-(b.p*1200+b.t));}
function upLive(){if(!ls||ls.dn||ls.ps)return;ls.t+=12;if(ls.pp&&(ls.p-1)*1200+ls.t>=ls.pp.end){addC('ppend',pk(C.ppend));ls.pp=null;}if(ls.t>=1200){hPEnd();return;}const ct=(ls.p-1)*1200+ls.t;ls.ev.filter(e=>(e.p-1)*1200+e.t<=ct&&(e.p-1)*1200+e.t>ct-12).forEach(procEv);if(ls.p===4&&ls.t>=300&&Math.random()<0.2)procEv({ty:Math.random()<0.55?'goal':'goalA'});if(ls.p===4&&ls.tG!==ls.oG)finM();render();}
function hPEnd(){ls.pSt.push({p:ls.p,tm:{...ls.st.tm},op:{...ls.st.op}});addC('period-break',pk(C.pend).replace('{p}',ls.p));if(ls.p<3){ls.ps=true;showBreak=true;clearInterval(mInt);render();}else if(ls.tG===ls.oG){addC('ot',pk(C.ot));ls.p=4;ls.t=0;render();}else finM();}
function contP(){showBreak=false;ls.p++;ls.t=0;ls.ps=false;ls.st.tm={sh:0,sv:0,ht:0};ls.st.op={sh:0,sv:0,ht:0};addC('pstart',pk(C.pstart).replace('{p}',ls.p));mInt=setInterval(upLive,spd());render();}
function procEv(ev){const pls=gs.roster.filter(p=>p.pos!=='G'&&!p.onLoan),pl=pk(pls)||{f:'X',l:'Y'},pn=`${pl.f.charAt(0)}.${pl.l}`,tn=gs.team.n.split(' ').pop();switch(ev.ty){case'goal':ls.tG++;ls.st.tm.sh++;if(ls.pp?.tm==='tm'){addC('ppgoal',pk(C.ppgoal).replace('{pl}',pn).replace('{s}',`${ls.tG}:${ls.oG}`));ls.pp=null;}else addC('goal',pk(C.goal).replace('{pl}',pn).replace('{s}',`${ls.tG}:${ls.oG}`));break;case'goalA':ls.oG++;ls.st.op.sh++;addC('goal-against',pk(C.goalA).replace('{s}',`${ls.tG}:${ls.oG}`));if(ls.pp?.tm==='tm')ls.pp=null;break;case'shot':ls.st.tm.sh++;addC('shot',pk(C.shot).replace('{pl}',pn));break;case'chance':ls.st.tm.sh++;addC('chance',pk(C.chance).replace('{pl}',pn));break;case'save':ls.st.tm.sv++;addC('save',pk(C.save).replace('{gl}',ls.gn));break;case'hit':ls.st.tm.ht++;addC('hit',pk(C.hit).replace('{pl}',pn));break;case'penalty':const isT=Math.random()<0.5;if(isT){addC('penalty',pk(C.penalty).replace('{pl}',pn));ls.pp={tm:'op',end:(ls.p-1)*1200+ls.t+120};}else{addC('penalty',pk(C.penalty).replace('{pl}',`${pk(FN).charAt(0)}.${pk(LN)}`));ls.pp={tm:'tm',end:(ls.p-1)*1200+ls.t+120};addC('ppstart',pk(C.ppstart));}break;case'icing':addC('icing',pk(C.icing));break;case'offside':addC('offside',pk(C.offside));break;case'poss':addC('poss',pk(C.poss).replace('{tm}',tn));break;case'crowd':addC('crowd',pk(C.crowd));break;}}
function addC(ty,tx){const m=Math.floor(ls.t/60),s=ls.t%60;ls.cm.unshift({ty,tx,ts:`${m}:${String(s).padStart(2,'0')}`});if(ls.cm.length>40)ls.cm.pop();}
function finM(){clearInterval(mInt);ls.dn=true;addC('end',pk(C.end));let res,pts;if(ls.tG>ls.oG){res=ls.p>3?'V√Ωhra PP':'V√Ωhra';pts=ls.p>3?2:3;}else{res=ls.p>3?'Prohra PP':'Prohra';pts=ls.p>3?1:0;}apRes(ls.tG,ls.oG,res,pts);render();}
function skipM(){clearInterval(mInt);while(ls.p<=3){ls.t=1200;if(ls.p<3)ls.p++;else break;}if(ls.tG===ls.oG){Math.random()>0.5?ls.tG++:ls.oG++;ls.p=4;}finM();}
function closeLive(){showLive=false;showBreak=false;ls=null;showRes=true;render();}
function chSpd(s){speed=s;if(mInt){clearInterval(mInt);mInt=setInterval(upLive,spd());}render();}
function qSim(){if(gs.week>52)return;const m=gs.schedule[gs.week-1],a=gs.roster.filter(p=>!p.onLoan),tS=a.reduce((s,p)=>s+p.o,0)/a.length,oS=m.opStr||70,hb=m.home?5:0,tac=getTacMods();let tG=Math.floor(Math.random()*4+((tS+hb)/30)*tac.shot),oG=Math.floor(Math.random()*4+(oS/30)/tac.def),res,pts;if(tG>oG){res='V√Ωhra';pts=3;}else if(tG<oG){res='Prohra';pts=0;}else{Math.random()>0.5?(tG++,res='V√Ωhra PP',pts=2):(oG++,res='Prohra PP',pts=1);}apRes(tG,oG,res,pts);showRes=true;render();}
function apRes(tG,oG,res,pts){const m=gs.schedule[gs.week-1];gs.roster=gs.roster.map(p=>{if(p.onLoan)return p;return{...p,gp:p.gp+1,g:p.g+(p.pos!=='G'?Math.floor(Math.random()*(tG/3)):0),a:p.a+(p.pos!=='G'?Math.floor(Math.random()*(tG/2)):0),pm:p.pm+(tG-oG),moral:Math.min(100,Math.max(20,p.moral+(pts>=2?2:-1)))};});gs.schedule[gs.week-1]={...m,done:true,tG,oG};const fr=pts>=2?'w':pts===1?'o':'l';gs.standings=gs.standings.map(t=>{if(t.id===gs.team.id)return{...t,pl:t.pl+1,w:t.w+(pts===3?1:0),otW:t.otW+(pts===2?1:0),otL:t.otL+(pts===1?1:0),l:t.l+(pts===0?1:0),gf:t.gf+tG,ga:t.ga+oG,pts:t.pts+pts,form:[fr,...(t.form||[])].slice(0,5)};if(t.id===m.opId){const op=pts===3?0:pts===0?3:pts===2?1:2;return{...t,pl:t.pl+1,pts:t.pts+op,form:[op>=2?'w':op===1?'o':'l',...(t.form||[])].slice(0,5)};}return{...t,pl:t.pl+1,pts:t.pts+Math.floor(Math.random()*4)};}).sort((a,b)=>b.pts-a.pts);const inc=m.home?cInc():50000,exp=Math.floor(gs.roster.filter(p=>!p.onLoan).reduce((s,p)=>s+p.sal,0)/52);gs.budget+=inc-exp;gs.happiness=pts>=2?Math.min(100,gs.happiness+3):Math.max(0,gs.happiness-2);lastRes={tG,oG,res,pts,inc};gs.week++;save();}

function trainP(pid,stat){const p=gs.roster.find(x=>x.id===pid);if(!p)return;const cost=Math.floor(p[stat]*10000);if(gs.budget<cost||p[stat]>=p.pot)return;gs.budget-=cost;p[stat]=Math.min(p.pot,p[stat]+1);p.o=Math.floor((p.sk+p.sh+p.pa+p.de+p.ph)/5);save();render();}
function extCont(pid,y,sm){const p=gs.roster.find(x=>x.id===pid);if(!p)return;const bon=Math.floor(p.sal*0.2*y);if(gs.budget<bon)return;gs.budget-=bon;p.sal=Math.floor(p.sal*sm);p.cYears=y;p.cSigned=0;showContract=null;save();render();}
function loanOut(pid){const p=gs.roster.find(x=>x.id===pid);if(!p||p.onLoan)return;p.onLoan=true;showLoan=null;save();render();}
function relP(id){const p=gs.roster.find(x=>x.id===id);if(!p)return;if(confirm(`Propustit ${p.f} ${p.l}?`)){gs.roster=gs.roster.filter(x=>x.id!==id);expP=null;save();render();}}
function signP(id){const p=gs.market.find(x=>x.id===id);if(!p||gs.budget<p.pr||gs.roster.length>=25)return;gs.budget-=p.pr;gs.roster.push({...p,gp:0,g:0,a:0,pm:0,onLoan:false});gs.market=gs.market.filter(x=>x.id!==id);save();render();}
function buyFromTeam(teamId,playerId){const ot=gs.otherTeams[teamId];if(!ot)return;const p=ot.roster.find(x=>x.id===playerId);if(!p)return;const price=calcPlayerPrice(p,teamId);if(gs.budget<price||gs.roster.length>=25)return;gs.budget-=price;gs.roster.push({...p,gp:0,g:0,a:0,pm:0,onLoan:false});ot.roster=ot.roster.filter(x=>x.id!==playerId);showBuy=null;save();render();}
function loanFromTeam(teamId,playerId){const ot=gs.otherTeams[teamId];if(!ot)return;const p=ot.roster.find(x=>x.id===playerId);if(!p)return;const fee=calcLoanFee(p)*12;if(gs.budget<fee||gs.roster.length>=25)return;gs.budget-=fee;const lp={...p,gp:0,g:0,a:0,pm:0,onLoan:false,loanFrom:teamId};gs.roster.push(lp);showBuy=null;save();render();}
function setTac(k,v){gs.tactic[k]=v;save();render();}

function render(){const app=document.getElementById('app');if(showLive&&ls)app.innerHTML=showBreak?rBreak():rLive();else if(showMode)app.innerHTML=rMode();else if(showTrain)app.innerHTML=rTrainMod();else if(showContract)app.innerHTML=rContMod();else if(showLoan)app.innerHTML=rLoanMod();else if(showBuy)app.innerHTML=rBuyMod();else if(viewTeam)app.innerHTML=rTeamView();else if(!gs.started)app.innerHTML=rSel();else app.innerHTML=`${rHdr()}<div class="cnt">${rTab()}</div>${rNav()}${showRes?rRes():''}`;bindEv();}

function rSel(){return`<div class="sel"><div class="logo-c">üèí</div><h1 class="title">HOKEJ MANA≈ΩER</h1><p class="sub">EXTRALIGA</p><h2 class="sec-t">Vyber t√Ωm</h2><div class="grid">${T.map(t=>`<div class="tmc" data-tid="${t.id}"><div class="tm-l" style="background:${t.cl}">${t.n.split(' ').pop().substring(0,3).toUpperCase()}</div><div class="nm">${t.n.split(' ').pop()}</div><div class="ct">${t.c}</div><div class="bg">${fmt(t.b)}</div></div>`).join('')}</div></div>`;}
function rMode(){const m=gs.schedule[gs.week-1],oi=getOppInfo(m.opId),ms=getTeamStr();return`<div class="modal"><div class="mdc"><div class="md-t">üèí Kolo ${gs.week}</div><div class="md-s">${m.home?'üè† Doma':'‚úàÔ∏è Venku'}</div><div class="mp-teams"><div class="mp-team"><div class="tm-l" style="background:${gs.team.cl}">${gs.team.n.split(' ').pop().substring(0,3).toUpperCase()}</div><div class="mp-team-name">${gs.team.n.split(' ').pop()}</div><div class="mp-team-str">S√≠la ${ms}</div></div><div class="mp-vs">VS</div><div class="mp-team"><div class="tm-l" style="background:${m.opC}">${m.op.split(' ').pop().substring(0,3).toUpperCase()}</div><div class="mp-team-name">${m.op.split(' ').pop()}</div><div class="mp-team-str">S√≠la ${m.opStr}</div></div></div><div style="margin:12px 0"><div style="font-size:10px;color:var(--txt3);margin-bottom:4px">Forma soupe≈ôe</div><div class="mp-form">${oi.form.slice(0,5).map(f=>`<div class="mp-form-dot ${f}">${f.toUpperCase()}</div>`).join('')||'‚Äî'}</div></div><div class="spd-s"><div class="spd-t">Rychlost</div><div class="spd-o">${['slow','normal','fast'].map(s=>`<button class="spd-b ${speed===s?'act':''}" data-spd="${s}">${s==='slow'?'üê¢':s==='normal'?'üèÉ':'üöÄ'}</button>`).join('')}</div></div><button class="md-b" id="cBtn"><div class="md-bh"><div class="md-bi">üì∫</div><div class="md-bt">S koment√°≈ôem</div></div></button><button class="md-b" id="qBtn"><div class="md-bh"><div class="md-bi">‚ö°</div><div class="md-bt">Rychle</div></div></button><button class="md-btn sec" id="canBtn">‚Üê Zpƒõt</button></div></div>`;}
function rTrainMod(){const p=gs.roster.find(x=>x.id===showTrain);if(!p)return'';return`<div class="modal"><div class="mdc"><div class="md-t">üèãÔ∏è Tr√©nink</div><div class="md-s">${p.f} ${p.l} ‚Ä¢ Pot ${p.pot}</div>${[{k:'sk',n:'Bruslen√≠'},{k:'sh',n:'St≈ôelba'},{k:'pa',n:'P≈ôihr√°vky'},{k:'de',n:'Obrana'},{k:'ph',n:'Fyziƒçka'}].map(s=>`<div class="train-stat"><span class="train-stat-name">${s.n}</span><div class="train-stat-val"><span class="train-stat-cur ${rc(p[s.k])}">${Math.round(p[s.k])}</span><button class="train-stat-btn" data-train="${s.k}" ${gs.budget>=p[s.k]*10000&&p[s.k]<p.pot?'':'disabled'}>+</button></div></div>`).join('')}<div style="text-align:center;font-size:11px;color:var(--txt3);margin:10px 0">~${fmt(Math.floor(p.o*10000))}/bod</div><button class="md-btn sec" id="closeTrainBtn">Zav≈ô√≠t</button></div></div>`;}
function rContMod(){const p=gs.roster.find(x=>x.id===showContract);if(!p)return'';return`<div class="modal"><div class="mdc"><div class="md-t">üìù Smlouva</div><div class="md-s">${p.f} ${p.l}</div><div class="cont-info"><div class="cont-row"><span class="cont-label">Plat</span><span class="cont-value">${fmt(p.sal)}/rok</span></div><div class="cont-row"><span class="cont-label">Zb√Ωv√°</span><span class="cont-value">${Math.max(0,p.cYears-p.cSigned).toFixed(1)} let</span></div></div><button class="md-btn grn" data-ext="2-1">2 roky</button><button class="md-btn pri" data-ext="3-1.1">3 roky (+10%)</button><button class="md-btn pur" data-ext="4-1.2">4 roky (+20%)</button><button class="md-btn sec" id="closeContBtn">Zav≈ô√≠t</button></div></div>`;}
function rLoanMod(){const p=gs.roster.find(x=>x.id===showLoan);if(!p)return'';return`<div class="modal"><div class="mdc"><div class="md-t">üîÑ Hostov√°n√≠</div><div class="md-s">${p.f} ${p.l}</div><button class="md-btn pur" id="confirmLoanBtn">Poslat na hostov√°n√≠</button><button class="md-btn sec" id="closeLoanBtn">Zru≈°it</button></div></div>`;}
function rBuyMod(){if(!showBuy)return'';const{teamId,playerId,mode}=showBuy;const ot=gs.otherTeams[teamId];const p=ot?.roster.find(x=>x.id===playerId);if(!p)return'';const team=T.find(t=>t.id===teamId);const price=calcPlayerPrice(p,teamId);const loanFee=calcLoanFee(p)*12;const canBuy=gs.budget>=price&&gs.roster.length<25;const canLoan=gs.budget>=loanFee&&gs.roster.length<25;return`<div class="modal"><div class="mdc"><div class="md-t">${mode==='buy'?'üí∞ Koupit':'üîÑ Hostovat'} hr√°ƒçe</div><div class="md-s">${p.f} ${p.l} z ${team?.n.split(' ').pop()}</div><div class="offer-info"><div class="offer-row"><span class="offer-label">Overall</span><span class="offer-value ${rc(p.o)}">${p.o}</span></div><div class="offer-row"><span class="offer-label">Pozice</span><span class="offer-value">${p.pos}</span></div><div class="offer-row"><span class="offer-label">Vƒõk</span><span class="offer-value">${p.age} let</span></div><div class="offer-row"><span class="offer-label">Plat</span><span class="offer-value">${fmt(p.sal)}/rok</span></div>${mode==='buy'?`<div class="offer-row"><span class="offer-label">Cena</span><span class="offer-value ylw">${fmt(price)}</span></div>`:`<div class="offer-row"><span class="offer-label">Poplatek (rok)</span><span class="offer-value pur">${fmt(loanFee)}</span></div>`}</div><div style="font-size:11px;color:var(--txt3);margin-bottom:12px">V√°≈° rozpoƒçet: ${fmt(gs.budget)}</div>${mode==='buy'?`<button class="md-btn grn" id="confirmBuyBtn" ${canBuy?'':'disabled'}>${canBuy?'‚úì Koupit':'Nedostatek Kƒç'}</button>`:`<button class="md-btn pur" id="confirmLoanInBtn" ${canLoan?'':'disabled'}>${canLoan?'‚úì Hostovat':'Nedostatek Kƒç'}</button>`}<button class="md-btn sec" id="closeBuyBtn">Zru≈°it</button></div></div>`;}

function rTeamView(){const tid=viewTeam;const team=T.find(t=>t.id===tid);const ot=gs.otherTeams[tid];const st=gs.standings.find(s=>s.id===tid);if(!team||!ot)return'';const avgOvr=Math.round(ot.roster.reduce((s,p)=>s+p.o,0)/ot.roster.length);return`<div class="team-header"><div class="team-header-top"><button class="team-back" id="teamBackBtn">‚Üê</button><div class="tm-l" style="background:${team.cl}">${team.n.split(' ').pop().substring(0,3).toUpperCase()}</div><div class="team-header-info"><div class="team-header-name">${team.n}</div><div class="team-header-city">${team.c}</div></div></div><div class="team-stats"><div class="team-stat"><div class="team-stat-val">${gs.standings.findIndex(s=>s.id===tid)+1}.</div><div class="team-stat-label">Pozice</div></div><div class="team-stat"><div class="team-stat-val">${st?.pts||0}</div><div class="team-stat-label">Body</div></div><div class="team-stat"><div class="team-stat-val ${rc(avgOvr)}">${avgOvr}</div><div class="team-stat-label">S√≠la</div></div><div class="team-stat"><div class="team-stat-val">${ot.roster.length}</div><div class="team-stat-label">Hr√°ƒç≈Ø</div></div></div></div><div class="team-roster-title"><span>Soupiska</span><span style="font-size:11px;color:var(--txt3)">${ot.willSell?'‚úì Prod√°v√°':'‚úó Neprod√°v√°'} ‚Ä¢ ${ot.willLoan?'‚úì P≈Øjƒçuje':'‚úó Nep≈Øjƒçuje'}</span></div><div class="pos-filter"><button class="pos-filter-btn ${posFilter==='all'?'act':''}" data-filter="all">V≈°e</button><button class="pos-filter-btn ${posFilter==='G'?'act':''}" data-filter="G">G</button><button class="pos-filter-btn ${posFilter==='D'?'act':''}" data-filter="D">D</button><button class="pos-filter-btn ${posFilter==='F'?'act':''}" data-filter="F">F</button></div><div class="pl">${ot.roster.filter(p=>posFilter==='all'||(posFilter==='G'&&p.pos==='G')||(posFilter==='D'&&p.pos==='D')||(posFilter==='F'&&['LW','C','RW'].includes(p.pos))).sort((a,b)=>b.o-a.o).map(p=>`<div class="pc ${expP===p.id?'exp':''}" data-pid="${p.id}"><div class="pm"><div class="pos ${pc(p.pos)}">${p.pos}</div><div class="pi"><div class="pn">${p.f} ${p.l}</div><div class="pd">${p.age}let ‚Ä¢ ${fmt(p.sal)}/r</div></div><div class="ovr ${rc(p.o)}">${Math.round(p.o)}</div></div>${expP===p.id?`<div class="pex"><div class="srow">${[{k:'sk',n:'BRU'},{k:'sh',n:'ST≈ò'},{k:'pa',n:'P≈òI'},{k:'de',n:'OBR'},{k:'ph',n:'FYZ'}].map(s=>`<div class="sbox"><div class="sbox-l">${s.n}</div><div class="sbox-v ${rc(p[s.k])}">${Math.round(p[s.k])}</div></div>`).join('')}</div><div class="pex-btns">${ot.willSell?`<button class="pex-btn buy" data-buyteam="${tid}" data-buyplayer="${p.id}">üí∞ Koupit (~${fmt(calcPlayerPrice(p,tid))})</button>`:''} ${ot.willLoan?`<button class="pex-btn loan" data-loanteam="${tid}" data-loanplayer="${p.id}">üîÑ Hostovat (~${fmt(calcLoanFee(p)*12)}/r)</button>`:''}</div></div>`:''}</div>`).join('')}</div>`;}

function rLive(){const s=ls,t=gs.team,pn=['','1.','2.','3.','PP'],m=Math.floor(s.t/60),sc=s.t%60;return`<div class="live"><div class="lhdr"><div class="lper">${!s.dn?'<span class="dot"></span>':''}${pn[s.p]}${s.dn?' KONEC':''}</div><div class="ltim">${String(m).padStart(2,'0')}:${String(sc).padStart(2,'0')}</div></div><div class="lscc"><div class="ltm"><div class="tm-l" style="background:${t.cl}">${t.n.split(' ').pop().substring(0,3).toUpperCase()}</div><div class="ltmn">${t.n.split(' ').pop()}</div></div><div class="lsc"><div class="lscn"><span style="color:${s.tG>s.oG?'var(--green)':'#fff'}">${s.tG}</span><span class="div">:</span><span style="color:${s.oG>s.tG?'var(--red)':'#fff'}">${s.oG}</span></div></div><div class="ltm"><div class="tm-l" style="background:${s.m.opC||'#334'}">${s.m.op.split(' ').pop().substring(0,3).toUpperCase()}</div><div class="ltmn">${s.m.op.split(' ').pop()}</div></div></div><div class="pstb"><div class="pst"><div class="pst-v">${s.st.tm.sh}</div><div class="pst-l">St≈ôely</div></div><div class="pst"><div class="pst-v">${s.st.tm.sv}</div><div class="pst-l">Z√°kroky</div></div><div class="pst"><div class="pst-v">${s.st.tm.ht}</div><div class="pst-l">Hity</div></div></div><div class="comc">${s.cm.map(c=>`<div class="comi ${c.ty}"><div class="comt">${c.ts}</div><div class="comtx">${c.tx}</div></div>`).join('')}</div><div class="lctl"><div class="lctl-r">${s.dn?`<button class="ctl-b suc" id="clBtn">‚úì OK</button>`:`<button class="ctl-b sec" id="skBtn">‚è≠</button>`}</div>${!s.dn?`<div class="spd-c"><span class="spd-lb">Rychlost</span><div class="spd-i">${['slow','normal','fast'].map(x=>`<div class="spd-d ${speed===x?'act':''}" data-spd="${x}"></div>`).join('')}</div></div>`:''}</div></div>`;}
function rBreak(){return`<div class="live"><div class="modal" style="background:rgba(0,0,0,0.9)"><div class="mdc"><div class="brk"><div class="brk-t">‚è∏Ô∏è P≈ôest√°vka</div><div class="brk-s">${ls.p}. t≈ôetina ‚Ä¢ ${ls.tG}:${ls.oG}</div><button class="md-btn pri" id="contBtn">‚ñ∂ ${ls.p+1}. t≈ôetina</button><button class="md-btn sec" id="skBrkBtn">‚è≠ P≈ôeskoƒçit</button></div></div></div></div>`;}
function rRes(){if(!lastRes)return'';const r=lastRes,w=r.pts>=2;return`<div class="modal"><div class="mdc"><div class="res-i ${w?'win':'loss'}">${w?'üèÜ':'üòî'}</div><div class="res-t" style="color:${w?'var(--green)':'var(--red)'}">${r.res}</div><div class="res-sc"><span style="color:${r.tG>r.oG?'var(--green)':'#fff'}">${r.tG}</span>:<span style="color:${r.oG>r.tG?'var(--red)':'#fff'}">${r.oG}</span></div><div class="res-d"><div class="res-di"><div class="res-dv blu">+${r.pts}</div><div class="res-dl">Body</div></div><div class="res-di"><div class="res-dv grn">+${fmt(r.inc)}</div><div class="res-dl">Kƒç</div></div></div><button class="md-btn pri" id="clResBtn">OK</button></div></div>`;}
function rHdr(){const t=gs.team;return`<div class="hdr"><div class="hdr-c"><div class="tm-i"><div class="tm-l" style="background:${t.cl}">${t.n.split(' ').pop().substring(0,3).toUpperCase()}</div><div><div class="tm-n">${t.n.split(' ').pop()}</div><div class="tm-s">Kolo ${gs.week}/52</div></div></div><div class="hdr-st"><div class="st-i"><div class="st-l">Kƒç</div><div class="st-v ${gs.budget<0?'red':'grn'}">${fmt(gs.budget)}</div></div><div class="st-i"><div class="st-l">Fans</div><div class="st-v blu">${gs.happiness}%</div></div><button class="play-btn" id="plBtn" ${gs.week>52?'disabled':''}>‚ñ∂</button></div></div></div>`;}
function rNav(){return`<nav class="nav">${[{id:'roster',ic:'üë•',lb:'T√Ωm'},{id:'tactics',ic:'üéØ',lb:'Taktika'},{id:'standings',ic:'üèÜ',lb:'Tabulka'},{id:'transfers',ic:'üîÑ',lb:'Trh'}].map(x=>`<button class="nav-b ${tab===x.id?'act':''}" data-tab="${x.id}"><span class="ic">${x.ic}</span>${x.lb}</button>`).join('')}</nav>`;}
function rTab(){switch(tab){case'roster':return rRos();case'tactics':return rTac();case'standings':return rStd();case'transfers':return rTra();default:return rRos();}}
function rRos(){const nm=getNextMatch(),a=gs.roster.filter(p=>!p.onLoan);let f=a;if(posFilter==='G')f=a.filter(p=>p.pos==='G');else if(posFilter==='D')f=a.filter(p=>p.pos==='D');else if(posFilter==='F')f=a.filter(p=>['LW','C','RW'].includes(p.pos));const srt=[...f].sort((a,b)=>b.o-a.o);return`${nm?`<div class="match-preview"><div class="mp-header"><div class="mp-title">üèí Dal≈°√≠ z√°pas</div><div class="mp-week">Kolo ${nm.wk} ‚Ä¢ ${nm.home?'üè†':'‚úàÔ∏è'}</div></div><div class="mp-teams"><div class="mp-team"><div class="tm-l" style="background:${gs.team.cl}">${gs.team.n.split(' ').pop().substring(0,3).toUpperCase()}</div><div class="mp-team-str">${getTeamStr()}</div></div><div class="mp-vs">VS</div><div class="mp-team"><div class="tm-l" style="background:${nm.opC}">${nm.op.split(' ').pop().substring(0,3).toUpperCase()}</div><div class="mp-team-str">${nm.opStr}</div></div></div></div>`:''}<div class="pos-filter"><button class="pos-filter-btn ${posFilter==='all'?'act':''}" data-filter="all">V≈°e (${a.length})</button><button class="pos-filter-btn ${posFilter==='G'?'act':''}" data-filter="G">G</button><button class="pos-filter-btn ${posFilter==='D'?'act':''}" data-filter="D">D</button><button class="pos-filter-btn ${posFilter==='F'?'act':''}" data-filter="F">F</button></div><div class="pl">${srt.map(p=>`<div class="pc ${expP===p.id?'exp':''}" data-pid="${p.id}"><div class="pm"><div class="pos ${pc(p.pos)}">${p.pos}</div><div class="pi"><div class="pn">${p.f} ${p.l}</div><div class="pd">${p.age}let ‚Ä¢ ${fmt(p.sal)}/r</div></div><div class="ovr ${rc(p.o)}">${Math.round(p.o)}</div></div>${expP===p.id?`<div class="pex"><div class="srow">${[{k:'sk',n:'BRU'},{k:'sh',n:'ST≈ò'},{k:'pa',n:'P≈òI'},{k:'de',n:'OBR'},{k:'ph',n:'FYZ'}].map(s=>`<div class="sbox"><div class="sbox-l">${s.n}</div><div class="sbox-v ${rc(p[s.k])}">${Math.round(p[s.k])}</div></div>`).join('')}</div><div class="pex-btns"><button class="pex-btn train" data-opentrain="${p.id}">üèãÔ∏è</button><button class="pex-btn contract" data-opencont="${p.id}">üìù</button><button class="pex-btn loan" data-openloan="${p.id}">üîÑ</button><button class="pex-btn release" data-rel="${p.id}">‚ùå</button></div></div>`:''}</div>`).join('')}</div>`;}
function rTac(){const t=gs.tactic,m=getTacMods();return`<div class="tac-section"><div class="tac-title">‚öîÔ∏è Styl</div><div class="tac-row">${[{k:'offensive',i:'‚öîÔ∏è',n:'√ötok'},{k:'balanced',i:'‚öñÔ∏è',n:'Balans'},{k:'defensive',i:'üõ°Ô∏è',n:'Obrana'},{k:'counter',i:'üéØ',n:'Proti'}].map(s=>`<button class="tac-opt ${t.style===s.k?'act':''}" data-tac="style-${s.k}"><div class="tac-opt-icon">${s.i}</div><div class="tac-opt-name">${s.n}</div></button>`).join('')}</div></div><div class="tac-section"><div class="tac-title">üí™ Intenzita</div><div class="tac-slider"><div class="tac-slider-label"><span>Pasivn√≠</span><span>Pressing ${t.pressing}%</span><span>Agresivn√≠</span></div><input type="range" min="0" max="100" value="${t.pressing}" data-tac="pressing"></div><div class="tac-slider"><div class="tac-slider-label"><span>Opatrn√Ω</span><span>Agresivita ${t.aggression}%</span><span>Tvrd√Ω</span></div><input type="range" min="0" max="100" value="${t.aggression}" data-tac="aggression"></div></div><div class="tac-section"><div class="tac-title">üìä Efekt</div><div class="tac-effect"><div class="tac-effect-row"><span>St≈ôelba</span><span class="${m.shot>=1?'grn':'red'}">${Math.round(m.shot*100)}%</span></div><div class="tac-effect-row"><span>Obrana</span><span class="${m.def>=1?'grn':'red'}">${Math.round(m.def*100)}%</span></div></div></div>`;}
function rStd(){return`<div style="padding:12px"><h2 style="font-size:16px;margin-bottom:8px">Tabulka</h2><p style="font-size:11px;color:var(--txt3);margin-bottom:12px">Klikni na t√Ωm pro zobrazen√≠ soupisky</p></div><table class="tbl"><thead><tr><th>#</th><th>T√Ωm</th><th>Z</th><th>B</th><th>Forma</th></tr></thead><tbody>${gs.standings.map((t,i)=>`<tr class="${t.id===gs.team.id?'usr':'clickable'}" data-viewteam="${t.id!==gs.team.id?t.id:''}"><td class="${i<4?'pg':i<10?'pb':'pr'}" style="font-weight:700">${i+1}</td><td><div class="tc"><div class="ml" style="background:${t.cl}">${t.n.split(' ').pop().substring(0,3).toUpperCase()}</div><span>${t.n.split(' ').pop()}</span></div></td><td>${t.pl}</td><td style="font-weight:700">${t.pts}</td><td><div class="mp-form">${(t.form||[]).slice(0,5).map(f=>`<div class="mp-form-dot ${f}">${f.toUpperCase()}</div>`).join('')}</div></td></tr>`).join('')}</tbody></table>`;}
function rTra(){return`<div class="tabs-cont"><button class="tab-btn ${subTab==='market'?'act':''}" data-stab="market">üõí Voln√≠ hr√°ƒçi</button><button class="tab-btn ${subTab==='teams'?'act':''}" data-stab="teams">üèí T√Ωmy</button></div>${subTab==='market'?rMarket():rTeams()}`;}
function rMarket(){return`<div style="padding:8px;display:flex;justify-content:space-between;align-items:center"><span style="font-size:11px;color:var(--txt3)">${gs.market.length} voln√Ωch hr√°ƒç≈Ø</span><button class="pos-filter-btn" id="refBtn">üîÑ</button></div><div class="pl">${gs.market.map(p=>`<div class="pc"><div class="pm"><div class="pos ${pc(p.pos)}">${p.pos}</div><div class="pi"><div class="pn">${p.f} ${p.l}</div><div class="pd">${p.age}let ‚Ä¢ ${fmt(p.pr)}</div></div><div style="text-align:right"><div class="ovr ${rc(p.o)}">${Math.round(p.o)}</div><button class="pex-btn buy" style="margin-top:4px" data-sign="${p.id}" ${gs.budget>=p.pr?'':'disabled'}>Koupit</button></div></div></div>`).join('')}</div>`;}
function rTeams(){return`<div style="padding:12px"><p style="font-size:11px;color:var(--txt3);margin-bottom:12px">Vyber t√Ωm pro zobrazen√≠ hr√°ƒç≈Ø ke koupi/hostov√°n√≠</p></div><div class="grid" style="padding:0 10px">${T.filter(t=>t.id!==gs.team.id).map(t=>{const ot=gs.otherTeams[t.id];const st=gs.standings.find(s=>s.id===t.id);return`<div class="tmc" data-viewteam="${t.id}"><div class="tm-l" style="background:${t.cl}">${t.n.split(' ').pop().substring(0,3).toUpperCase()}</div><div class="nm">${t.n.split(' ').pop()}</div><div class="ct">${st?`${st.pts} bod≈Ø`:'‚Äî'}</div><div style="font-size:9px;margin-top:4px">${ot?.willSell?'<span class="grn">Prod√°v√°</span>':''} ${ot?.willLoan?'<span class="pur">P≈Øjƒçuje</span>':''}</div></div>`;}).join('')}</div>`;}

function bindEv(){document.querySelectorAll('.tmc[data-tid]').forEach(el=>{el.onclick=()=>{const tm=T.find(t=>t.id===el.dataset.tid);if(tm)stG(tm);};});document.querySelectorAll('[data-viewteam]').forEach(el=>{if(el.dataset.viewteam)el.onclick=()=>{viewTeam=el.dataset.viewteam;posFilter='all';expP=null;render();};});document.querySelectorAll('.nav-b[data-tab]').forEach(el=>{el.onclick=()=>{tab=el.dataset.tab;expP=null;viewTeam=null;render();};});document.querySelectorAll('.tab-btn[data-stab]').forEach(el=>{el.onclick=()=>{subTab=el.dataset.stab;render();};});document.querySelectorAll('.pos-filter-btn[data-filter]').forEach(el=>{el.onclick=()=>{posFilter=el.dataset.filter;render();};});const plBtn=document.getElementById('plBtn');if(plBtn)plBtn.onclick=shMode;const qBtn=document.getElementById('qBtn');if(qBtn)qBtn.onclick=()=>stMatch(false);const cBtn=document.getElementById('cBtn');if(cBtn)cBtn.onclick=()=>stMatch(true);const canBtn=document.getElementById('canBtn');if(canBtn)canBtn.onclick=()=>{showMode=false;render();};document.querySelectorAll('[data-spd]').forEach(el=>{el.onclick=()=>{speed=el.dataset.spd;if(mInt){clearInterval(mInt);mInt=setInterval(upLive,spd());}render();};});const skBtn=document.getElementById('skBtn');if(skBtn)skBtn.onclick=skipM;const clBtn=document.getElementById('clBtn');if(clBtn)clBtn.onclick=closeLive;const contBtn=document.getElementById('contBtn');if(contBtn)contBtn.onclick=contP;const skBrkBtn=document.getElementById('skBrkBtn');if(skBrkBtn)skBrkBtn.onclick=()=>{showBreak=false;skipM();};const clResBtn=document.getElementById('clResBtn');if(clResBtn)clResBtn.onclick=()=>{showRes=false;lastRes=null;render();};document.querySelectorAll('.pc[data-pid]').forEach(el=>{const pm=el.querySelector('.pm');if(pm)pm.onclick=()=>{expP=expP===el.dataset.pid?null:el.dataset.pid;render();};});document.querySelectorAll('[data-rel]').forEach(el=>{el.onclick=e=>{e.stopPropagation();relP(el.dataset.rel);};});document.querySelectorAll('[data-sign]').forEach(el=>{el.onclick=e=>{e.stopPropagation();signP(el.dataset.sign);};});const refBtn=document.getElementById('refBtn');if(refBtn)refBtn.onclick=()=>{gs.market=gM();save();render();};document.querySelectorAll('[data-opentrain]').forEach(el=>{el.onclick=e=>{e.stopPropagation();showTrain=el.dataset.opentrain;render();};});document.querySelectorAll('[data-opencont]').forEach(el=>{el.onclick=e=>{e.stopPropagation();showContract=el.dataset.opencont;render();};});document.querySelectorAll('[data-openloan]').forEach(el=>{el.onclick=e=>{e.stopPropagation();showLoan=el.dataset.openloan;render();};});const closeTrainBtn=document.getElementById('closeTrainBtn');if(closeTrainBtn)closeTrainBtn.onclick=()=>{showTrain=null;render();};document.querySelectorAll('[data-train]').forEach(el=>{el.onclick=()=>trainP(showTrain,el.dataset.train);});const closeContBtn=document.getElementById('closeContBtn');if(closeContBtn)closeContBtn.onclick=()=>{showContract=null;render();};document.querySelectorAll('[data-ext]').forEach(el=>{const[y,m]=el.dataset.ext.split('-').map(Number);el.onclick=()=>extCont(showContract,y,m);});const closeLoanBtn=document.getElementById('closeLoanBtn');if(closeLoanBtn)closeLoanBtn.onclick=()=>{showLoan=null;render();};const confirmLoanBtn=document.getElementById('confirmLoanBtn');if(confirmLoanBtn)confirmLoanBtn.onclick=()=>loanOut(showLoan);document.querySelectorAll('[data-buyteam][data-buyplayer]').forEach(el=>{el.onclick=e=>{e.stopPropagation();showBuy={teamId:el.dataset.buyteam,playerId:el.dataset.buyplayer,mode:'buy'};render();};});document.querySelectorAll('[data-loanteam][data-loanplayer]').forEach(el=>{el.onclick=e=>{e.stopPropagation();showBuy={teamId:el.dataset.loanteam,playerId:el.dataset.loanplayer,mode:'loan'};render();};});const closeBuyBtn=document.getElementById('closeBuyBtn');if(closeBuyBtn)closeBuyBtn.onclick=()=>{showBuy=null;render();};const confirmBuyBtn=document.getElementById('confirmBuyBtn');if(confirmBuyBtn)confirmBuyBtn.onclick=()=>buyFromTeam(showBuy.teamId,showBuy.playerId);const confirmLoanInBtn=document.getElementById('confirmLoanInBtn');if(confirmLoanInBtn)confirmLoanInBtn.onclick=()=>loanFromTeam(showBuy.teamId,showBuy.playerId);const teamBackBtn=document.getElementById('teamBackBtn');if(teamBackBtn)teamBackBtn.onclick=()=>{viewTeam=null;expP=null;render();};document.querySelectorAll('[data-tac]').forEach(el=>{const[k,v]=el.dataset.tac.split('-');if(el.tagName==='INPUT')el.oninput=()=>setTac(k,parseInt(el.value));else el.onclick=()=>setTac(k,v);});}
load();render();
</script>
</body>
</html>
